project(':clojuresque') {
    apply {
        plugin 'groovy'
        plugin 'maven'
    }

    group = 'clojuresque'
    version = '1.4.0-SNAPSHOT'

    dependencies {
        compile gradleApi()
        groovy localGroovy()
    }

    uploadArchives.doLast {
        if (!project.version.endsWith("-SNAPSHOT")) {
            String pomName = project.buildDirName + "/" + project.pomDirName + "/" +
                project.name + "-" + project.version + ".xml"

            project.pom().writeTo(pomName)

            project.exec {
                commandLine(
                    '/usr/bin/scp',
                    project.file(project.tasks.jar.archivePath).path,
                    project.file(pomName).path,
                    'clojars@clojars.org:'
                )
            }
        }
    }
}
