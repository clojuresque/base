usePlugin 'java'
usePlugin 'groovy'
usePlugin 'maven'

group = 'clojuresque'
version = '1.1.0'

def gradle_home = new File(System.getenv()['GRADLE_HOME'])
def gradle_lib = new File(gradle_home, "lib")

repositories {
    mavenCentral()
    flatDir name: 'gradle', dirs: gradle_lib
}

dependencies {
    compile 'org.clojure:clojure:1.0.0'

    groovy name: 'groovy', version: '1.6.4'
    groovy name: 'gradle-core', version: '0.8'
    groovy name: 'asm-all', version: '2.2.3'
    groovy name: 'slf4j-api', version:'1.5.3'
    groovy name: 'logback-core', version:'0.9.9'
    groovy name: 'logback-classic', version:'0.9.9'
    groovy name: 'antlr', version:'2.7.7'
    groovy name: 'ant', version:'1.7.0'
}

// Dummy to make gradle generate a POM.
uploadArchives {
    repositories.mavenDeployer {
        repository(url: String.format("file://%s/dummy-repo", project.buildDir.path))
    }
}

task deployClojars(dependsOn: uploadArchives) << {
    ant.exec(executable: '/usr/bin/scp') {
        arg(value: String.format("%s/poms/pom-default.xml",
            project.buildDir.path))
        arg(value: String.format("%s/libs/%s-%s.jar",
            project.buildDir.path,
            project.name, project.version))
        arg(value: "clojars@clojars.org:")
    }
}
